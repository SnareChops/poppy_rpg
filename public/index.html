<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Poppy's Dungeon</title>
    <script src="https://extension-files.twitch.tv/helper/v1/twitch-ext.min.js"></script>
    <script>
      window.Twitch.ext.onAuthorized(async function (auth) {
        const viewerUserId = window.Twitch.ext.viewer.id;
        if (viewerUserId) {
          const defaultOptions = {
            headers: {
              Authorization: auth.helixToken ? `Extension ${auth.helixToken}` : "",
              "client-id": auth.clientId,
            },
          };

          const response = await fetch(`https://api.twitch.tv/helix/users?id=${viewerUserId}`, defaultOptions);
          const json = await response.json();
          if (json) {
            localStorage.setItem("twitchName", json.data[0].display_name);
          }
        }
      });
    </script>
    <!-- <script src="/socket.io/socket.io.js"></script> -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css"
      integrity="sha512-NhSC1YmyruXifcj/KFRWoC561YpHpc5Jtzgvbuzx5VozKpWvQ+4nXhPdFgmx8xqexRcpAglTj9sIBWINXa8x5w=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
    <link rel="stylesheet" href="stylesheets/player-client.css" />
    <style>
      html,
      body {
        background-color: #664488;
        color: black;
        font-family: Arial, Helvetica, sans-serif;
        width: 100%;
        height: 100%;
      }

      .flex {
        display: flex;
        flex-direction: column;
      }

      .row {
        display: flex;
        flex-direction: row;
      }

      .screen {
        max-width: 600px;
        flex-wrap: wrap;
        /* width: 318px;
        height: 496px;
        border: 2px solid black; */
      }

      .hidden {
        display: none;
      }

      #main-screen {
        display: flex;
        flex-direction: column;
      }

      #main-screen header {
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
      }

      #main-screen header h2 {
        margin-bottom: 0;
      }

      #main-screen header h1 {
        margin-top: 0.5em;
      }

      #main-screen main {
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
      }

      #character-screen {
        display: flex;
        flex-direction: column;
      }

      #character-form {
        display: flex;
        flex-direction: column;
        height: 100%;
      }

      #character-screen .player-display {
        display: flex;
        flex-direction: row;
        height: 300px;
        background: url(images/mori_jungle.png);
        background-size: cover;
      }

      #character-screen .controls {
        padding: 0.5rem;
        display: flex;
        flex-direction: column;
        flex: 1 1;
      }

      #character-screen .controls label {
        margin: 0.5rem 0;
      }

      #character-screen .player-view {
        display: flex;
        flex-direction: column;
        flex: 1 1;
      }

      #character-screen .player-form {
        flex: 1 0;
        background: url(images/parchment.jpg);
        background-size: cover;
        padding: 0.2rem;
        color: black;
        font-size: 14px;
        font-weight: 600;
        letter-spacing: -0.2px;
        font-family: monospace;
      }

      #player-character {
        width: 100%;
        height: auto;
      }

      #game-screen {
        display: flex;
        flex-direction: column;
        height: 100%;
      }

      #game-screen .player-display {
        flex: 0 0;
        display: flex;
        flex-direction: column;

        padding: 1em;
        background: url(images/mori_jungle.png);
        background-size: 110%;
        background-position: bottom;
      }

      #game-screen .player-stats {
        position: absolute;
        display: flex;
        flex-direction: column;
        padding: 0.5rem;
        background: linear-gradient(
          137deg,
          rgba(255, 255, 255, 0.6951155462184874) 0%,
          rgba(255, 255, 255, 0.6979166666666667) 16%,
          rgba(0, 0, 0, 0) 100%
        );
      }

      #game-screen .player-display .player-view {
        position: relative;
        top: 20px;
        left: 30px;
      }

      #game-view-character {
        width: 100%;
        height: auto;
      }

      #game-screen .player-display h5 {
        margin: 0;
      }

      #game-screen .player-display .hp {
        display: flex;
        flex-direction: column;
      }

      #game-screen .player-display #player-name {
        margin: 0;
      }

      #game-screen .player-display #player-job {
        font-size: 1rem;
        font-weight: 400;
      }

      #game-screen .player-display #player-hp-text {
        margin: 0;
      }

      #game-screen .player-controls {
        flex: 0 0;
        display: flex;
        flex-direction: column;
        flex-wrap: wrap;
        padding-top: 0.5em;
        padding-left: 0.5em;
        /* background: url(images/parchment.jpg); */
      }

      #game-screen .player-controls .button-row {
        flex: 1 1;
      }

      #game-screen .actions {
        margin-right: 0.5em;
        margin-bottom: 0.5em;
        padding: 0.5em;
        flex: 1 1;
      }

      .tabs-container {
        flex: 1 1;
      }

      .badge {
        width: 50px;
        height: auto;
      }

      #log {
        padding: 0.6rem;
        height: 100px;
        overflow-y: scroll;
      }
    </style>
  </head>
  <body class="flex">
    <script src="player-client.js" type="module"></script>
  </body>
</html>
